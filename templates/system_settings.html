<!DOCTYPE html>
<html lang="en">

<head>
    <!-- // META AND DOCUMENT SETUP // -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Settings - BantayTubig</title>

    <!-- // STYLESHEETS & FONTS // -->
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='system_settings.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>

    <!-- // BACKGROUND VIDEO & UNIVERSAL UI ELEMENTS // -->
    <video autoplay muted loop id="backgroundVideo">
        <source src="{{ url_for('static', filename='BantayTubig.mp4') }}" type="video/mp4">
    </video>
    <div class="header-top-left">
        <div class="menu-icon">&#9776;</div>
    </div>
    
    <!-- Sidebar Menu: A slide-out navigation panel. -->
    {% include '_sidebar.html' %}

    <div class="header-top-right">
        <h1>System Settings</h1>
        <div id="timestamp">I-configure ang mga pangkalahatang setting ng system</div>
    </div>

    <!-- // MAIN PAGE CONTENT // -->
    <div class="main-content settings-page">

        <!-- Accordion Item 1: General Settings -->
        <div class="settings-accordion-item">
            <button class="settings-toggle-btn">General Settings <span class="arrow-icon">▼</span></button>
            <div class="settings-content-panel">
                <div class="content-card">
                    <div class="tooltip-container"><span class="tooltip-icon">?</span>
                        <div class="tooltip-message">
                            <p>Dito isinasaayos ang mga pangunahing setting ng system, tulad ng pangalan nito.</p>
                            <p><em>Here you can configure the system's basic settings, such as its name.</em></p>
                        </div>
                    </div>
                    <div class="settings-form">
                        <div class="form-group"><label for="systemName">System Name</label><input type="text"
                                id="systemName" placeholder="Loading..."><small>Set a custom name for the monitoring
                                platform.</small></div>
                        </div>
                </div>
            </div>
        </div>

        <!-- Accordion Item 2: Network & Connectivity -->
        <div class="settings-accordion-item">
            <button class="settings-toggle-btn">Network & Connectivity <span class="arrow-icon">▼</span></button>
            <div class="settings-content-panel">
                <div class="content-card">
                    <div class="tooltip-container"><span class="tooltip-icon">?</span>
                        <div class="tooltip-message">
                            <p>Pamahalaan ang koneksyon ng device sa internet. Maaari mong tingnan ang kasalukuyang
                                status at kumonekta sa mga Wi-Fi network.</p>
                            <p><em>Manage the device's internet connection. You can view the current status and connect
                                    to Wi-Fi networks.</em></p>
                        </div>
                    </div>
                    <div class="network-status-card">
                        <h3>Current Status</h3>
                        <div id="networkStatusContent">
                            <p><strong>Status:</strong> <span
                                    class="status-badge status-disconnected">Checking...</span></p>
                            <p><strong>SSID:</strong> <span id="currentSsid">N/A</span></p>
                            <p><strong>IP Address:</strong> <span id="currentIp">N/A</span></p>
                        </div>
                    </div>
                    <div class="available-networks-card">
                        <div class="card-header">
                            <h3>Available Wi-Fi Networks</h3><button id="scanWifiBtn" class="action-button small"><span class="button-icon-placeholder"></span> Scan</button>
                        </div>
                        <div class="table-wrapper">
                            <table id="wifiListTable">
                                <thead>
                                    <tr>
                                        <th>SSID</th>
                                        <th>Signal</th>
                                        <th>Security</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="wifiListBody">
                                    <tr>
                                        <td colspan="4">Click 'Scan' to find networks.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <button id="showLcdModalBtn" class="form-btn secondary-btn full-width-btn">View LCD Instructions</button>
                </div>
            </div>
        </div>
        
        <!-- Accordion Item 3: Security Settings -->
        <div class="settings-accordion-item">
            <button class="settings-toggle-btn">Security <span class="arrow-icon">▼</span></button>
            
            <div class="settings-content-panel">
                <div class="content-card">
                    <div class="tooltip-container"><span class="tooltip-icon">?</span>
                        <div class="tooltip-message">
                            <p>I-configure ang mga setting na may kaugnayan sa seguridad, tulad ng session timeout at pagpapalit ng iyong password.</p>
                            <p><em>Configure security-related settings, such as session timeout for inactivity and changing your account password.</em></p>
                        </div>
                    </div>

                    <div class="settings-form">
                        <h3>Change Password</h3>

                        <form id="changePasswordForm">
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" required autocomplete="current-password">
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="newPassword">New Password</label>
                                    <input type="password" id="newPassword" required autocomplete="new-password">
                                    <small>Password should be at least 6 characters long.</small>
                                </div>
                                <div class="form-group">
                                    <label for="confirmPassword">Confirm New Password</label>
                                    <input type="password" id="confirmPassword" required autocomplete="new-password">
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="action-button">Change Password</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Accordion Item 4: UI & Display Settings -->
        <div class="settings-accordion-item">
            <button class="settings-toggle-btn">UI & Display <span class="arrow-icon">▼</span></button>
            <div class="settings-content-panel">
                <div class="content-card">
                    <div class="tooltip-container"><span class="tooltip-icon">?</span>
                        <div class="tooltip-message">
                            <p>I-customize ang mga elementong ipinapakita sa dashboard.</p>
                            <p><em>Customize the elements shown on the dashboard.</em></p>
                        </div>
                    </div>
                    <div class="settings-form">
                        <div class="form-group-toggle">
                            <label for="showMlConfidenceToggle">Show ML Confidence Details</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showMlConfidenceToggle">
                                <span class="slider"></span>
                            </label>
                            <small>Show/hide the prediction confidence bar on the main dashboard card.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    <!-- // FLOATING ACTION BUTTONS // -->
    <!-- This container holds the Save, Logout, and Shutdown buttons. -->
    <div class="floating-actions">
        <!-- This button triggers the shutdown sequence for the device. -->
        <div id="currentUser" data-role="{{ session['user_role'] }}"></div>
        <button id="powerOffBtn" class="action-button danger" title="Stop Application & Shut Down">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="power-icon"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path><line x1="12" y1="2" x2="12" y2="12"></line></svg>
        </button>
        
        <!-- This button saves any changes made on the settings page. -->
        <button id="saveSettingsBtn" class="action-button">Save Changes</button>
    </div>

    
    <!-- // MODALS (Password, Data Cleanup, Toasts, etc.) // -->
    <!-- These are hidden by default and shown by JavaScript for user interaction. -->
    <div id="lcdInstructionModal" class="lcd-modal-overlay">
        <div class="lcd-modal-content">
            <div class="lcd-modal-header">
                <h5 class="lcd-modal-title">Mga Tagubilin sa LCD Display <span class="english-translation">(LCD Display Instructions)</span></h5>
                <button class="lcd-close-modal-btn">&times;</button>
            </div>
            <div class="lcd-modal-body">
                <p>
                    Pagkatapos magtagumpay na kumonekta sa WiFi network, ang LCD screen ng device ay magpapakita ng isang link o IP address.
                    <span class="english-translation">
                        (After successfully connecting to a WiFi network, the device's LCD screen will display a link or IP address.)
                    </span>
                </p>
                <p>
                    **Paki-check ang LCD screen para mahanap ang tamang address para ma-access ang web dashboard.**
                    <span class="english-translation">
                        (Please check the LCD screen to find the correct address for accessing the web dashboard.)
                    </span>
                </p>
            </div>
        </div>
    </div>

    <!-- // MODAL for WIFI PASSWORD // -->
    <div id="wifiPasswordModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="wifiModalTitle">Connect to Network</h2><button id="closeWifiModalBtn"
                    class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="wifiConnectForm"><input type="hidden" id="wifiSsidInput">
                    <div class="form-group"><label for="wifiPasswordInput">Password for <strong
                                id="ssidNameLabel"></strong></label><input type="password" id="wifiPasswordInput"
                            placeholder="Enter network password" autocomplete="current-password"></div>
                    <div class="form-actions"><button type="submit" class="action-button">Connect</button></div>
                </form>
            </div>
        </div>
    </div>
    
    <div id="confirmationModal" class="modal-overlay">
        <div class="modal-content confirm-modal-content">
            <div class="modal-header">
                <h2 id="confirmationModalTitle">Are you sure?</h2>
                <button id="closeConfirmationModalBtn" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmationModalText">This action cannot be undone.</p>
            </div>
            <div class="form-actions">
                <button id="confirmationCancelBtn" class="action-button secondary">Cancel</button>
                <button id="confirmationConfirmBtn" class="action-button deactivate">Confirm</button>
            </div>
        </div>
    </div>

     <!-- // MODAL for TOAST NOTIFICATIONS (SUCCESS/INFO) // -->
    <div id="toastModal" class="toast-modal">
        <div class="toast-content">
            <div id="toastIcon" class="toast-icon">
                <!-- SVG Icon will be inserted here by JavaScript -->
            </div>
            <p id="toastMessage" class="toast-message"></p>
        </div>
    </div>
    
    <div id="liveAlertBanner" class="live-alert-banner">
        <div class="live-alert-icon">🔔</div>
        <div class="live-alert-content">
            <p id="liveAlertTitle" class="live-alert-title">New Alert</p>
            <p id="liveAlertDetails" class="live-alert-details">Details of the alert...</p>
        </div>
        <div id="liveAlertActions" class="live-alert-actions">
            <button id="snoozeLiveAlertBtn">Snooze</button>
            <button id="ackLiveAlertBtn">Acknowledge</button>
        </div>
        <button id="closeLiveAlertBtn" class="close-live-alert-btn">&times;</button>
    </div>

    <div id="networkStatusBanner" class="network-status-banner">
        <span id="networkStatusIcon">⚠️</span>
        <span id="networkStatusText">No network connection. Displayed data may not be live.</span>
    </div>
    
    
    <!-- // SCRIPTS // -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='global_alerter.js') }}"></script>
    <script src="{{ url_for('static', filename='system_settings.js') }}"></script>
</body>

</html>